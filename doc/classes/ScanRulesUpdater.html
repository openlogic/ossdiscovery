<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: ScanRulesUpdater</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">ScanRulesUpdater</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/lib/scan_rules_updater_rb.html">
                lib/scan_rules_updater.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
<a href="ScanRulesUpdater.html">ScanRulesUpdater</a>, believe it or not, is
responsible for updating scan rules. This is done by going out to a server
and downloading the latest and greates scan rules.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000052">backup_scanrules_dir</a>&nbsp;&nbsp;
      <a href="#M000049">download_file</a>&nbsp;&nbsp;
      <a href="#M000055">get_YYYYMMDD_HHMM_str</a>&nbsp;&nbsp;
      <a href="#M000053">get_default_scan_rules_dir</a>&nbsp;&nbsp;
      <a href="#M000051">http_get_file</a>&nbsp;&nbsp;
      <a href="#M000050">http_get_rules_files_to_download</a>&nbsp;&nbsp;
      <a href="#M000047">new</a>&nbsp;&nbsp;
      <a href="#M000056">rollback_update</a>&nbsp;&nbsp;
      <a href="#M000054">scrub_url_path</a>&nbsp;&nbsp;
      <a href="#M000048">update_scanrules</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">base_url</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">proxy_host</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">proxy_password</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">proxy_port</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">proxy_username</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000052" class="method-detail">
        <a name="M000052"></a>

        <div class="method-heading">
          <a href="ScanRulesUpdater.src/M000052.html" target="Code" class="method-signature"
            onclick="popupCode('ScanRulesUpdater.src/M000052.html');return false;">
          <span class="method-name">backup_scanrules_dir</span><span class="method-args">(local_scan_rules_dir=nil, bak_extension=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Method is intended only as a helper internal to this class. It is only
accessible so it can be tested.
</p>
<p>
Backs up the default scan rules directory. &#8217;.svn&#8217; directories
are deleted.
</p>
<p>
Returns the expanded path to the backup directory.
</p>
        </div>
      </div>

      <div id="method-M000055" class="method-detail">
        <a name="M000055"></a>

        <div class="method-heading">
          <a href="ScanRulesUpdater.src/M000055.html" target="Code" class="method-signature"
            onclick="popupCode('ScanRulesUpdater.src/M000055.html');return false;">
          <span class="method-name">get_YYYYMMDD_HHMM_str</span><span class="method-args">(time=Time.new)</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>

      <div id="method-M000053" class="method-detail">
        <a name="M000053"></a>

        <div class="method-heading">
          <a href="ScanRulesUpdater.src/M000053.html" target="Code" class="method-signature"
            onclick="popupCode('ScanRulesUpdater.src/M000053.html');return false;">
          <span class="method-name">get_default_scan_rules_dir</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>

      <div id="method-M000047" class="method-detail">
        <a name="M000047"></a>

        <div class="method-heading">
          <a href="ScanRulesUpdater.src/M000047.html" target="Code" class="method-signature"
            onclick="popupCode('ScanRulesUpdater.src/M000047.html');return false;">
          <span class="method-name">new</span><span class="method-args">(base_url)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Construct a <a href="ScanRulesUpdater.html">ScanRulesUpdater</a>. The
&#8216;base_url&#8217; argument is intended to be the base_url of the site
that contains the list of rules files that tells what to download, and the
actual downloadable files themselves.
</p>
<p>
EG&#8230;
</p>
<p>
The following url is to the xml that will show all possible rules files.
</p>
<pre>
  http://localhost:3000/rules_files.xml
</pre>
<p>
The &#8216;base_url&#8217; in this case would be <a
href="http://localhost:3000">localhost:3000</a>/
</p>
<hr size="3"></hr><p>
The following url&#8216;s are to the downloadable scan rules files
themselves (the list of these will have come from the aforementioned
rules_files.xml).
</p>
<pre>
  http://localhost:3000/rules/scan-rules.xml
  http://localhost:3000/rules/scan-rules-mvngen.xml
</pre>
<p>
Again, the &#8216;base_url&#8217; is <a
href="http://localhost:3000">localhost:3000</a>/
</p>
<hr size="3"></hr><p>
This class assumes that the &#8216;rules_file.xml&#8217; file and the
downloadable files themselves with have the same &#8216;base_url&#8216;
</p>
        </div>
      </div>

      <div id="method-M000056" class="method-detail">
        <a name="M000056"></a>

        <div class="method-heading">
          <a href="ScanRulesUpdater.src/M000056.html" target="Code" class="method-signature"
            onclick="popupCode('ScanRulesUpdater.src/M000056.html');return false;">
          <span class="method-name">rollback_update</span><span class="method-args">(dir_with_rollback_content, rules_dir=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Method is intended only as a helper internal to this class. It is only
accessible so it can be tested.
</p>
<p>
This is the method that gets called in case something went wrong with the
process of downloading updated scan rules. It&#8216;s job is to get the
state of the client&#8216;s scan rules back to what it was before the
update process ever began.
</p>
<p>
Params:
</p>
<pre>
  * dir_with_rollback_content - This is the dir that holds the original scan rules (the last valid set
    of scan rules we had before trying to update to the new ones).  It will be named something like:
    '.../rules/openlogic_20071106_0950.bak'
  * rules_dir - This argument is only available for testing, because by default, in a real
    client-in-production scenario, this will always be '.../rules/openlogic'.
</pre>
        </div>
      </div>

      <div id="method-M000054" class="method-detail">
        <a name="M000054"></a>

        <div class="method-heading">
          <a href="ScanRulesUpdater.src/M000054.html" target="Code" class="method-signature"
            onclick="popupCode('ScanRulesUpdater.src/M000054.html');return false;">
          <span class="method-name">scrub_url_path</span><span class="method-args">(url_path)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Method is intended only as a helper internal to this class. It is only
accessible so it can be tested.
</p>
<p>
if &#8216;url-path&#8217; is equal to &quot;/rules_files.xml&quot; then
this method returns &quot;rules_files.xml&quot;
</p>
<p>
if &#8216;url-path&#8217; is equal to &quot;rules_files.xml&quot; then this
method returns &quot;rules_files.xml&quot; (does nothing)
</p>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000049" class="method-detail">
        <a name="M000049"></a>

        <div class="method-heading">
          <a href="ScanRulesUpdater.src/M000049.html" target="Code" class="method-signature"
            onclick="popupCode('ScanRulesUpdater.src/M000049.html');return false;">
          <span class="method-name">download_file</span><span class="method-args">(file_to_download_path, dest_dir=&quot;&quot;)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Method is intended only as a helper internal to this class. It is only
accessible so it can be tested.
</p>
<p>
Downloads a file (by streaming it down from the server).
</p>
<p>
params:
</p>
<pre>
  * file_to_download_path - As per the example given in the documentation for initialize, this refers to
    the actual downloadable scan rules file that is available on the server. Assuming you can
    navigate to this file in a browser by going to 'http://localhost:3000/rules/scan-rules.xml', this value would be:

      /rules/scan-rules.xml
        or
      rules/scan-rules.xml
  * dest_dir - Where you want the file to be saved/downloaded to.
</pre>
        </div>
      </div>

      <div id="method-M000051" class="method-detail">
        <a name="M000051"></a>

        <div class="method-heading">
          <a href="ScanRulesUpdater.src/M000051.html" target="Code" class="method-signature"
            onclick="popupCode('ScanRulesUpdater.src/M000051.html');return false;">
          <span class="method-name">http_get_file</span><span class="method-args">( a_url )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
encapsulates all the support we need to do an http request - including
https or proxy support several places needed the same functionality, so put
it here.
</p>
<p>
returns a response object
</p>
<p>
raises an Exception if the HTTP response was errant (aka&#8230; was not in
the 2xx range). Uses the Net::HTTPResponse.value method to do so.
</p>
<p>
TODO - we may want to pull this out and extend Net::HTTP with this helper
</p>
        </div>
      </div>

      <div id="method-M000050" class="method-detail">
        <a name="M000050"></a>

        <div class="method-heading">
          <a href="ScanRulesUpdater.src/M000050.html" target="Code" class="method-signature"
            onclick="popupCode('ScanRulesUpdater.src/M000050.html');return false;">
          <span class="method-name">http_get_rules_files_to_download</span><span class="method-args">(rules_files_url_path)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
requests a file of rules files to download.
</p>
<p>
returns the contents as a set of rules files to download
</p>
        </div>
      </div>

      <div id="method-M000048" class="method-detail">
        <a name="M000048"></a>

        <div class="method-heading">
          <a href="ScanRulesUpdater.src/M000048.html" target="Code" class="method-signature"
            onclick="popupCode('ScanRulesUpdater.src/M000048.html');return false;">
          <span class="method-name">update_scanrules</span><span class="method-args">(local_scan_rules_dir, rules_files_url_path)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The most important method of this class. The one intended to be used by
outsiders. params:
</p>
<pre>
  * local_scan_rules_dir - The path of the local scan rules directory housing all updateable scan rules.
    'updateable scan rules' are those that live in the 'rules/openlogic' directory of this client.
    A distinction is being made because the user may create their own scan rules in the 'rules/drop_ins' directory.
    The latter will not be updated, as the server does not have them.  This argument can be safely passed as nil,
    and the ':rules_openlogic' property will be used from the client's config.yml.
  * rules_files_url_path -

     There is no default for this value.  A valid value must be passed in for this operation to work.
</pre>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>